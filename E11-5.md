# アナログ入力

あくまでコンピュータはデジタルを扱うことをメインにした電子回路の一種だが、電子回路には 0V や 5V だけでなく 1.5V や 3V といった様々な電圧が利用される。
PWM は高速で HIGH と LOW を切り替えて擬似的に「アナログ電圧を出力する」方法であった。
ここでは、Arduino で「アナログ電圧を入力する」方法を紹介する。

*Ref: 教科書 pp.40*

# A/D コンバータ

アナログ電圧は、直接コンピュータ (CPU) で扱うことはできない。
そのため、アナログ電圧をデジタルデータに変換する必要がある。

それをするための特別なハードウェアを **A/D コンバータ** という。
実は Arduino のプロセッサには A/D コンバータが搭載されていて、これを使うとアナログ電圧をデジタルに変換してコンピュータで読み取ることができる。

A/D 変換は、主につぎの 3 つのステップで構成される：

**1. 標本化**

まず、アナログ信号を一定間隔でサンプリングする。サンプリング間隔は、**サンプリング周波数**と呼ばれる逆数で表される。サンプリング周波数は、アナログ信号の最高周波数よりも**2倍以上**高くなければならない。これは、**ナイキスト定理**と呼ばれる理論に基づいている。

**2. 量子化**

次に、サンプリングされた各値を有限個のレベルに量子化する。量子化レベルは、**量子化ビット数**と呼ばれる数で決定される。量子化ビット数が多いほど、量子化レベルが細かくなり、精度が高くなる。これを **「分解能」** という。

Arduino に搭載されている A/D コンバータは *10bit* の分解能をもち、5V の電圧を 1023 段階に分けて表現することができる。

**3. 符号化**

最後に、量子化された各値を符号化して、デジタル信号に変換する。符号化には、さまざまな方法があるが、一般的には2進数表現が使用される。

これらの3つのステップを順番に行うことで、アナログ信号をデジタル信号に変換することができる。

### AD変換の応用例

AD変換は、さまざまな分野で用いられています。代表的な例は以下のとおり：

* **音声処理**：マイクで入力された音声信号をデジタル信号に変換する。
* **画像処理**：カメラで入力された画像信号をデジタル信号に変換する。
* **計測**：温度や圧力などのアナログ量をデジタル信号に変換する。
* **通信**：アナログ信号をデジタル信号に変換して、通信回線に送る。

* **基本情報技術者平成28年秋期問5 A/D変換処理の順番**：[https://www.fe-siken.com/kakomon/28_aki/q5.html](https://www.fe-siken.com/kakomon/28_aki/q5.html)


# プログラム

- このプログラムを実行し、エネループ電池の電圧を測ってみよう。
- **質問:** (1) の行はどういうことをしているか説明せよ。

*Ref:教科書 pp.41*

```ino
const int INPUT_PIN = 1;

void setup(){
    Serial.begin( 9600 );   // USB に結果を表示するための準備
}

void loop(){
    int analog_val;
    float volt_val;

    analog_val = analogRead( INPUT_PIN );
    volt_val = (float)analog_val / 1023.0 * 5.0;    // (1)

    Serial.print( "Value:" );
    Serial.print( analog_val );
    Serial.print( " Volt:" );
    Serial.println( volt_val );

    delay(500);
}
```